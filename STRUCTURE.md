# 🏗️ هيكل البوت بعد إضافة ميزات المالك

```
┌─────────────────────────────────────────────────────────┐
│                    🤖 TELEGRAM BOT                      │
│                  Arab Advanced Bot                      │
└─────────────────────────────────────────────────────────┘
                            │
                ┌───────────┴───────────┐
                │                       │
        ┌───────▼──────┐        ┌──────▼──────┐
        │ 👤 مستخدم عادي│        │   👑 مالك   │
        └───────┬──────┘        └──────┬──────┘
                │                      │
    ┌───────────▼──────────┐           │
    │  لوحة مفاتيح عادية  │           │
    ├─────────────────────┤           │
    │ 🕌 الختمة           │           │
    │ 📿 الأذكار          │           │
    │ 📖 القرآن           │           │
    │ 💭 الاقتباسات       │           │
    │ ✍️ الشعر            │           │
    │ 🎮 الألعاب          │           │
    │ 💰 الاقتصاد         │           │
    │ 👤 حسابي            │           │
    │ 🏆 المتصدرين        │           │
    │ ⚙️ الإعدادات        │           │
    └─────────────────────┘           │
                              ┌───────▼──────────┐
                              │ لوحة مفاتيح المالك│
                              ├─────────────────┤
                              │ 🕌 الختمة       │
                              │ 📿 الأذكار      │
                              │ 📖 القرآن       │
                              │ 💭 الاقتباسات   │
                              │ 🎮 الألعاب      │
                              │ 💰 الاقتصاد     │
                              │ 👤 حسابي        │
                              │ 🏆 المتصدرين    │
                              │👑 لوحة المالك ⭐│
                              │ ⚙️ الإعدادات    │
                              └───────┬─────────┘
                                      │
                    ┌─────────────────▼──────────────────┐
                    │       👑 لوحة تحكم المالك         │
                    └─────────────────┬──────────────────┘
                                      │
        ┌─────────────────────────────┼────────────────────────────┐
        │                             │                            │
    ┌───▼────┐                   ┌───▼────┐                  ┌───▼────┐
    │📊 إحصاء│                   │👥 مستخدم│                  │📢 بث   │
    │البوت   │                   │        │                  │        │
    └───┬────┘                   └───┬────┘                  └───┬────┘
        │                            │                            │
  ┌─────▼─────┐               ┌─────▼──────┐              ┌─────▼──────┐
  │• كل المستخدم│               │• عرض الكل   │              │• رسالة HTML│
  │• النشطون   │               │• بحث        │              │• للجميع    │
  │• المحظورون │               │• حظر/إلغاء  │              │• تدريجي    │
  │• العملات   │               │• عملات      │              │• إحصائيات │
  │• النقاط    │               │• XP         │              └────────────┘
  │• DB Info   │               │• حذف        │
  └────────────┘               │• إعادة تعيين│
                               └─────────────┘
                                      
        ┌─────────────────────────────┼────────────────────────────┐
        │                             │                            │
    ┌───▼────┐                   ┌───▼────┐                  ┌───▼────┐
    │💰 اقتصاد│                   │🗄️ قاعدة│                  │📝 سجلات│
    │        │                   │البيانات │                  │        │
    └───┬────┘                   └───┬────┘                  └───┬────┘
        │                            │                            │
  ┌─────▼─────┐               ┌─────▼──────┐              ┌─────▼──────┐
  │• أغنى     │               │• معلومات   │              │• وقت التشغيل│
  │• إحصائيات │               │• Collections│              │• الطلبات   │
  │• مكافأة كل│               │• حجم DB     │              │• الأخطاء   │
  │• خصم كل   │               │• مستندات   │              │• الذاكرة   │
  │• المتجر   │               │• نسخ احتياطي│              │• الاتصال  │
  └───────────┘               │• استرجاع   │              └────────────┘
                              │• تنظيف     │
                              └────────────┘

        ┌─────────────────────────────┼────────────────────────────┐
        │                             │                            │
    ┌───▼────┐                   ┌───▼────┐                  ┌───▼────┐
    │⚡ أنظمة│                   │🗑️ تنظيف│                  │🚫 محظور│
    │        │                   │        │                  │        │
    └───┬────┘                   └───┬────┘                  └───┬────┘
        │                            │                            │
  ┌─────▼─────┐               ┌─────▼──────┐              ┌─────▼──────┐
  │• حالة البوت│               │• غير نشطين │              │• قائمة     │
  │• PID       │               │• +90 يوم   │              │• سبب الحظر │
  │• الذاكرة   │               │• تأكيد     │              │• إلغاء حظر │
  │• DB Status │               │• حذف       │              │• إحصائيات │
  │• Node.js   │               │• تقرير     │              └────────────┘
  │• Platform  │               └────────────┘
  └────────────┘

```

---

## 📂 هيكل الملفات

```
بوت/
├── src/
│   ├── index.js                    ⭐ ربط الأوامر والأزرار
│   ├── commands/
│   │   ├── commandHandler.js      ⭐ معالجات المالك الجديدة
│   │   ├── menuHandler.js
│   │   ├── gameHandler.js
│   │   ├── economyHandler.js
│   │   ├── contentHandler.js
│   │   └── profileHandler.js
│   ├── ui/
│   │   ├── keyboards.js           ⭐ لوحات مفاتيح المالك
│   │   └── formatter.js
│   ├── database/
│   │   ├── db.js
│   │   └── models/
│   │       ├── User.js
│   │       ├── Group.js
│   │       ├── Transaction.js
│   │       └── ...
│   ├── economy/
│   ├── games/
│   ├── content/
│   ├── moderation/
│   ├── ai/
│   └── utils/
├── .env                            ⭐ BOT_OWNERS
├── package.json
├── OWNER_FEATURES.md               ⭐ دليل شامل
├── OWNER_QUICK_GUIDE.md            ⭐ دليل سريع
├── CHANGELOG_OWNER.md              ⭐ سجل التحديثات
└── STRUCTURE.md                    ⭐ هذا الملف
```

---

## 🔐 نظام الصلاحيات

```
┌─────────────────────────────────┐
│         فحص الصلاحيات          │
└─────────────┬───────────────────┘
              │
       ┌──────▼──────┐
       │  ctx.from.id│
       └──────┬──────┘
              │
       ┌──────▼──────────┐
       │  BOT_OWNERS    │
       │  من .env        │
       └──────┬──────────┘
              │
     ┌────────▼────────┐
     │  isOwner()?     │
     └────┬──────┬─────┘
          │      │
      ✅  │      │  ❌
          │      │
  ┌───────▼──┐  │  ┌─────▼──────┐
  │ صلاحية  │  │  │ رفض الطلب   │
  │ كاملة   │  │  │ "غير مصرح" │
  └──────────┘  │  └────────────┘
                │
                │
      ┌─────────▼──────────┐
      │ للمستخدمين العاديين│
      │ صلاحيات محدودة     │
      └─────────────────────┘
```

---

## 🔄 تدفق البيانات

### مثال: بث رسالة

```
    المالك
      │
      ▼
  [👑 لوحة المالك]
      │
      ▼
  [📢 بث رسالة]
      │
      ▼
  [ctx.session.ownerAwait = 'broadcast']
      │
      ▼
  [المالك يكتب الرسالة]
      │
      ▼
  [معالج النصوص - ownerAwait]
      │
      ├──► [فحص: isOwner?]
      │         │
      │         ▼
      │    [✅ مصرح]
      │         │
      │         ▼
      │    [جلب كل المستخدمين من DB]
      │         │
      │         ▼
      │    [حلقة: لكل مستخدم]
      │         │
      │         ├──► [إرسال رسالة]
      │         │         │
      │         │         ├──► ✅ نجح
      │         │         └──► ❌ فشل
      │         │
      │         ▼
      │    [تأخير 100ms]
      │         │
      │         ▼
      │    [المستخدم التالي]
      │         │
      │         ▼
      │    [إحصائيات النهائية]
      │         │
      │         ▼
      └────[عرض النتيجة للمالك]
              │
              ▼
          ✅ تم
```

---

## 💾 تخزين البيانات

```
MongoDB
  │
  ├── users                    (المستخدمون)
  │   ├── userId: Number
  │   ├── firstName: String
  │   ├── coins: Number
  │   ├── xp: Number
  │   ├── level: Number
  │   ├── banned: Boolean      ⭐ للحظر
  │   ├── bannedReason: String ⭐ سبب الحظر
  │   ├── lastActiveDay: Date  ⭐ للتنظيف
  │   └── ...
  │
  ├── transactions             (المعاملات)
  │   ├── userId: Number
  │   ├── type: String
  │   ├── amount: Number
  │   └── ...
  │
  ├── gamestats               (إحصائيات الألعاب)
  ├── groups                  (المجموعات)
  ├── content                 (المحتوى)
  └── config                  (الإعدادات)
```

---

## 🎯 نقاط الدخول (Entry Points)

### للمستخدم العادي:
```
/start  ──►  UIManager.mainReplyKeyboard()
                    │
                    ▼
            لوحة مفاتيح عادية
```

### للمالك:
```
/start  ──►  isOwner() ──► UIManager.ownerReplyKeyboard()
                                    │
                                    ▼
                            لوحة مفاتيح المالك
                                    │
                                    ▼
                         [👑 لوحة المالك]
                                    │
                                    ▼
                    CommandHandler.handleOwnerPanel()
```

---

## 🛡️ الحماية والتحقق

```
┌──────────────────────────┐
│   كل عملية للمالك        │
└────────────┬─────────────┘
             │
      ┌──────▼──────┐
      │ isOwner()?  │
      └──┬──────┬───┘
         │      │
     ✅  │      │  ❌
         │      │
    ┌────▼──┐   └──► [رسالة خطأ]
    │ تنفيذ │        "غير مصرح"
    └───────┘
```

---

## 📊 الإحصائيات المتوفرة

```
📊 إحصائيات البوت
    ├── 👥 المستخدمون
    │   ├── الكل
    │   ├── النشطون (7 أيام)
    │   └── المحظورون
    │
    ├── 💰 الاقتصاد
    │   ├── مجموع العملات
    │   ├── مجموع النقاط
    │   └── عدد المعاملات
    │
    ├── 🎮 الألعاب
    │   └── إحصائيات محفوظة
    │
    └── 🗄️ قاعدة البيانات
        ├── الاسم
        ├── الحجم (MB)
        └── عدد المستندات
```

---

## 🎨 واجهة المستخدم

### المستخدم العادي:
```
┌────────────────────────┐
│  👋 مرحباً صديقي!      │
│  🎯 اختر من المفاتيح: │
└────────────────────────┘
```

### المالك:
```
┌──────────────────────────────┐
│  👑 أهلاً بك يا مالك البوت! │
│  ⚡ لديك صلاحيات كاملة      │
│  🎯 اختر من لوحتك الخاصة:  │
└──────────────────────────────┘
```

---

## 🚀 الأداء

```
معالجة الطلبات
    │
    ├── فحص صلاحيات: ~1ms
    ├── استعلام DB: ~50-200ms
    ├── معالجة: ~10-100ms
    └── الرد: ~100-500ms
                │
                ▼
        ⚡ سريع وفعال
```

---

**هذا الهيكل يوضح التنظيم الكامل للبوت بعد إضافة ميزات المالك! 🎉**
